<!DOCTYPE html>
<html lang="en" {{ "{{" }}% raw %{{ "}}" }} >
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css">
    <title>Chatbot</title>
</head>
<body>
    <div id="app">
        <div class="wrapper">
            <div class="title">Chatbot</div>
            <div class="box">
                {% for index in range(UserChat | length) %}
                <div class="item" :class="{'right': true}">
                    <div class="msg">
                        <p>{{ UserChat[index]['chatmessage']}}</p>
                    </div>
                </div>
                <div class="item" :class="{'right': false}">
                    <div class="msg">
                        <p>{{ AIChat[index]['chatmessage']}}</p>
                    </div>
                </div>
                {%  endfor %}
                <div class="item" v-for="chat in chatLogs" :class="{ 'right': !chat.isReply }">
<!--                    <div class="icon">-->
<!--                        <i class="fa fa-user"></i>-->
<!--                    </div>-->
                    <div class="msg">
                        <p>{{ "{{" }} chat.message {{ "}}" }}</p>
                    </div>
                </div>
                <br clear="both">
<!--                <div class="item right">-->
<!--                    <div class="msg">-->
<!--                        <p>123</p>-->
<!--                    </div>-->
<!--                </div>-->
            </div>

            <div class="typing-area">
                <div class="input-field">
                    <input type="text" placeholder="Type your message" required v-model="message">
                    <button type="submit" class="btn btn-secondary" v-on:click="test_post">SEND</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>

    <!-- Vue Start -->
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <script>
      axios.defaults.withCredentials = true;

      const app = new Vue({
        el: "#app",
        data: {
            message: '',
            chatLogs: [],
        },
        methods: {
          test_get: () => {
              axios("/chat", {
                method: "get"
              }, {
                withCredentials: true
              })
                .then((response) => {
                  console.log(response.data);

                })
                .catch((error) => {
                  console.log(error);
                });
            },
            // 화살표 함수로 정의를 하니 this가 Vue인스턴스를 가리키지 못해서 일반 function()으로 바꿨다.
            test_post: function() {

              this.chatLogs.push({
                      message: this.message,
                      isReply: false,
                  });

              axios.post("/response", {
                message: this.message,
              },{
                withCredentials: true
              })
                .then((response) => {
                  console.log(response.data);

                  this.chatLogs.push({
                      message: response.data.reply,
                      isReply: true,
                  });
                })
                .catch((error) => {
                  console.log(error);
                });
              this.message = '';
            },
        },
      });
    </script>
</body>
</html>